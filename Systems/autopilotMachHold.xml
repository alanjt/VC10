<?xml version="1.0"?>
<!--
    Autopilot Configuration for the VC10.
-->
<PropertyList>
	<!--
    ============================================================
   Pitch Modes - Mach Hold
    ============================================================
-->

	
	<!-- integrator thetaRef_deg tracks pitch angle theta-deg while Autopilot is not in Mach hold mode-->
	<filter>
<!--		<name>pitch_reference</name> 
		<debug>false</debug>-->
		<type>integrator</type>
		<gain>1.0</gain>
		<input>
			<condition><not><property>autopilot/switches/Mach-sw</property></not></condition>
			<expression>
				<dif>
					<property>fdm/jsbsim/attitude/theta-deg</property>
					<property>autopilot/MachHold/thetaRef_deg</property>
				</dif>
			</expression>
		</input>
		<output><property>autopilot/MachHold/thetaRef_deg</property></output>
		<u_min>-20</u_min>
		<u_max>20</u_max>
	</filter>

	<!-- integrator MachRef tracks Mach while Autopilot is not in Mach hold mode-->
	<filter>
<!--		<name>Mach_Reference</name> 
		<debug>false</debug> -->
		<type>integrator</type>
		<gain>1.0</gain>
		<input>
			<condition><not><property>autopilot/switches/Mach-sw</property></not></condition>
			<expression>
				<dif>
					<property>velocities/mach</property>
					<property>autopilot/MachHold/MachRef</property>
				</dif>
			</expression>
		</input>
		<output><property>autopilot/MachHoldMachRef</property></output>
		<output><property>autopilot/MachHold/MachRef</property></output>
		<u_min>-20</u_min>
		<u_max>40000</u_max>
	</filter>

	<filter>
<!--		<name>Mach hold gain</name> 
		<debug>false</debug> -->
		<type>gain</type>
		<gain>0.5</gain>
		<input><value>-1.0</value></input>
		<output><property>autopilot/MachHold/KMach</property></output>
	</filter>
	
	<filter><!-- datum knob changes Mach reference by + or minus 17% -->
<!--		<name>MachRef2</name>
		<debug>false</debug>  -->
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<expression>
				<product>
					<property>autopilot/MachHold/MachRef</property>
					<sum>
						<product>
							<property>autopilot/settings/datum_norm</property>
							<value>0.15</value>
						</product>
						<value>1.0</value>
					</sum>
				</product>
			</expression>
		</input>
		<output><property>autopilot/MachHold/MachRef2</property></output>
		<u_min>0.2</u_min>
		<u_max>0.866</u_max>  <!-- Mm0 0.866 -->
	</filter>
	
	<filter>
<!--		<name>Mach Error</name>
		<debug>false</debug> -->
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<expression>
				<dif>
					<property>velocities/mach</property>
					<property>autopilot/MachHold/MachRef2</property>
				</dif>
			</expression>
		</input>
		<output><property>autopilot/MachHold/MachERR</property></output>
	</filter>
	
	<filter>
<!--		<name>Mach Error Limit</name>
		<debug>false</debug> -->
		<type>gain</type>
		<gain>1.0</gain>
		<input><property>autopilot/MachHold/MachERR</property></input>
		<output><property>autopilot/MachHold/MachOUT</property></output>
		<u_min>-200</u_min><!-- limit L3 -->
		<u_max>200</u_max>
	</filter>
	
	<filter>
		<type>exponential</type><!-- The exponential filter is more commonly known as a 1st order lag filter -->
		<debug>false</debug>
		<enable>
			<condition><property>autopilot/Logic/AP1orAP2-sw</property></condition>
		</enable>
		<filter-time>0.5</filter-time><!-- TV3 -->
		<input><property>autopilot/MachHold/MachOUT</property></input>
		<output><property>autopilot/MachHold/MachOUTlag</property></output>
	</filter>
	
	<filter>
<!--		<name>Mach error integrator</name>
		<debug>false</debug> -->
		<type>integrator</type>
		<gain>0.05</gain><!-- integrator gain -->

		<input>
			<condition><property>autopilot/switches/Mach-sw</property></condition>
			<property>autopilot/MachHold/MachOUT</property>
		</input>
		
		<input>
			<expression>
				<product>
					<value>-100.0</value><!-- negative feeback to reduce output towards zero -->
					<property>autopilot/MachHold/MachOTInt</property>
				</product>
			</expression>
		</input>
		
		<output><property>autopilot/MachHold/MachOTInt</property></output>
		<u_min>-100</u_min>
		<u_max>100</u_max>
	</filter>

	<filter>
<!--		<name>Mach Mode hdot feedback</name> 
		<debug>false</debug>-->
		<type>gain</type>
		<gain>1.0</gain><!-- A3 -->
		<input>
			<property>fdm/jsbsim/velocities/h-dot-fps</property>
		</input>
		<output>
			<property>autopilot/MachHold/Machhdot</property>
		</output>
	</filter>
	
	<filter>
<!--		<name>Mach Mode pitch demand</name>
		<debug>false</debug> -->
		<type>gain</type>
		<gain><property>autopilot/MachHold/KMach</property></gain>
		<input>
			<expression>
				<sum>-->
					<property>autopilot/MachHold/MachOUTlag</property>
					<property>autopilot/MachHold/MachOTInt</property>
					<property>autopilot/MachHold/Machhdot</property>
					<value>0.0</value>
				</sum>
			</expression>
		</input>
		<output>autopilot/MachHold/THECOM</output>
		<u_min>-20</u_min>
		<u_max>20</u_max>
	</filter>
	

</PropertyList>
