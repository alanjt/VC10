<?xml version="1.0"?>
<!--
    Autopilot Configuration for the VC10.
-->
<PropertyList>
	<!--
    ===============
    Azimuth Control System and Roll Autostabiliser. 
    ===============
    -->
	<!-- Gains -->

	<filter>
		<name>KPSI</name>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<expression>
				<product>
					<value>0.005</value>
					<!-- 1/Uo = 1/200 for Uo = 200ft/sec -->
					<property>autopilot/LGUIDE/a_psi</property>
					<property>fdm/jsbsim/velocities/u-aero-fps</property>
				</product>
			</expression>
		</input>
		<output>
			<property>autopilot/LGUIDE/KPSI</property>
		</output>
	</filter>
	
<!-- gain correction correction factor due to distance from localiser tranmitter -->
<!--	
instrumentation/nav/gs-distance and instrumentation/nav/nav-distance
<filter>
		<name>Krange</name>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<expression>
				<product>
					<value>0.005</value>
					<property>autopilot/LGUIDE/a_psi</property>
					<property>fdm/jsbsim/velocities/u-aero-fps</property>
				</product>
			</expression>
		</input>
		<output>
			<property>autopilot/LGUIDE/Krange</property>
		</output>
	</filter> -->
	
	<!-- Limits -->
	<!-- Magnetic heading -->
	<filter>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<property>orientation/heading-magnetic-deg</property>
		</input>
		<output>
			<property>autopilot/LGUIDE/PSI</property>
		</output>
	</filter>
	<!-- Inputs from FG -->
	
	<!-- Course (OBD) Knob -->
	<filter>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<property>instrumentation/nav[0]/radials/selected-deg</property>
		</input>
		<output>
			<property>autopilot/LGUIDE/PSI_S</property>
		</output>
	</filter>
	
	<!-- HDG Knob -->
	<filter>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<property>autopilot/settings/heading-knob</property>
		</input>
		<output>
			<property>autopilot/LGUIDE/PSI_R</property>
		</output>
	</filter>
	
	<!-- beam error -->
	<filter>
		<name>VOR/LOC Beam Error degrees</name>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<condition>
				<!-- ILS - Full scale 2 dots = 2.5 deg -->
				<property>instrumentation/nav/frequencies/is-localizer-frequency</property>
			</condition>
			<expression>
				<product>
					<property>instrumentation/nav/heading-needle-deflection</property>
					<value>-2.5</value>
				</product>
			</expression>
		</input>
		<!-- not an ILS frequency - assume VOR -->
		<input>
			<!-- VOR - Full scale 2 dots = 10 deg -->
			<expression>
				<product>
					<property>instrumentation/nav/heading-needle-deflection</property>
					<value>-10.0</value>
				</product>
			</expression>
		</input>
		<output>
			<property>autopilot/LGUIDE/Beta_Deg</property>
		</output>
		<!--		<u_min>-10</u_min><u_max>10</u_max> -->
	</filter>
	
	<!-- ######################################################################################## -->
	<!-- ILS/VOR radial error (Compass Course Knob - compass magnetic heading) -->
	<!-- Used for VOR radial tracking, LOC beam tracking and runway decrab control -->
	<filter>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<property>autopilot/LGUIDE/PSI</property>
		</input>
		<!-- magnetic heading -->
		<reference>
			<property>autopilot/LGUIDE/PSI_R</property>
		</reference>
		<!-- CRS knob -->
		<output>
			<property>autopilot/LGUIDE/PSI_E</property>
		</output>
		<period><min>-180</min><max>180</max></period>
		<u_min>-25</u_min><u_max>25</u_max>
		<!-- L3 -->
	</filter>
	
	<!-- Heading demand error (Compass Heading Knob - compass magnetic heading) -->
	<!-- Used during beam intercept -->
	<filter>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<property>autopilot/LGUIDE/PSI</property>
		</input>
		<!-- magnetic heading -->
		<reference>
			<property>autopilot/LGUIDE/PSI_S</property>
		</reference>
		<!-- HDG knob -->
		<output>
			<property>autopilot/LGUIDE/PSI_C</property>
		</output>
		<period><min>-180</min><max>180</max></period>
		<u_min>-25</u_min><u_max>25</u_max>
		<!-- limit  LGL3 -->
	</filter>
	
	<filter>
		<name>Heading error washout (synthetic diferentiation)</name>
		<debug>false</debug>
		<type>high-pass</type>
		<gain>1.0</gain>
		<filter-time><property>autopilot/LGUIDE/t1</property></filter-time>
		<input>
			<property>autopilot/LGUIDE/PSI_E</property>
		</input>
		<output>
			<property>autopilot/LGUIDE/PSI_E_washout</property>
		</output>
	</filter>
	
	<!-- After beam capture use washed out course error in place of course error -->
	<filter>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<condition>
				<property>autopilot/LGUIDE/ONC</property>
			</condition>
			<property>autopilot/LGUIDE/PSI_E_washout</property>
			<!-- ONC set -->
		</input>
		<input>
			<property>autopilot/LGUIDE/PSI_E</property>
			<!-- ONC not set -->
		</input>
		<output>
			<property>autopilot/LGUIDE/PSI_E_F</property>
		</output>
	</filter>
	
	<!-- course error signal for roll command output -->
	<filter>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<expression>
				<product>
					<property>autopilot/LGUIDE/PSI_E_F</property>
					<property>autopilot/LGUIDE/b1</property>
				</product>
			</expression>
		</input>
		<output>
			<property>autopilot/LGUIDE/PSI_E_B1</property>
		</output>
	</filter>
	<!-- VOR/LOC beam error filters -->
	<filter>
		<name>VOR_LOC-beam lowpass filter></name>
		<type>exponential</type>
		<debug>false</debug>
		<initialize-to>output</initialize-to>
		<gain>1.0</gain>
		<filter-time><property>autopilot/LGUIDE/t4</property></filter-time>
		<input>
			<expression>
				<product>
					<property>autopilot/LGUIDE/a2</property>
					<property>autopilot/LGUIDE/Beta_Deg</property>
				</product>
			</expression>
		</input>
		<output>
			<property>autopilot/LGUIDE/Beta_Lag</property>
		</output>
	</filter>
	<!-- VOR/LOC beam synthetic rate -->
	<filter>
		<name>VOR_LOC-beam rate filter part 1 - washout (diferentiation + intial smoothing)</name>
		<debug>false</debug>
		<type>high-pass</type>
		<gain>1.0</gain>
		<filter-time><property>autopilot/LGUIDE/t2</property></filter-time>
		<input>
			<expression>
				<product>
					<property>autopilot/LGUIDE/Beta_Deg</property>
					<property>autopilot/LGUIDE/a1</property>
				</product>
			</expression>
		</input>
		<output>
			<property>autopilot/LGUIDE/Beta_washout</property>
		</output>
	</filter>
	<filter>
		<name>VOR_LOC-beam rate filter part 2 - low pass (more smoothing)</name>
		<debug>false</debug>
		<type>exponential</type>
		<gain>1.0</gain>
		<filter-time><property>autopilot/LGUIDE/t3</property></filter-time>
		<!-- t3-->
		<input>
			<property>autopilot/LGUIDE/Beta_washout</property>
		</input>-->
		<output>
			<property>autopilot/LGUIDE/Beta_dot</property>
		</output>
	</filter>
	<filter>
		<name>VOR_LOC-beam error limited</name>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<expression>
				<product>
					<property>autopilot/LGUIDE/Beta_Lag</property>
					<property>autopilot/LGUIDE/a2</property>
				</product>
			</expression>
		</input>
		<output>
			<property>autopilot/LGUIDE/Beta_Lag_limited</property>
		</output><u_min>-1.5</u_min><u_max>1.5</u_max>
		<!-- L1 -->
	</filter>
	<filter>
		<name>VOR_LOC-beam integrator filter></name>
		<debug>false</debug>
		<type>integrator</type>
		<gain>1.0</gain>
		<input>
			<!-- run integrator when Beam Error less than +- 0.2 degrees and ONC is set -->
			<condition>
				<and>
					<less-than>
						<property>autopilot/LGUIDE/Beta_Deg_abs</property>
						<property>autopilot/LGUIDE/L2</property>
					</less-than>
					<property>autopilot/LGUIDE/ONC</property>
				</and>
			</condition>
			<property>autopilot/LGUIDE/Beta_Deg</property>
		</input>
		<input>
			<!-- otherwise, apply fedback to zero integrator -->
			<expression>
				<product>
					<property>autopilot/LGUIDE/Beta_Integ</property>
					<value>-10</value>
				</product>
			</expression>
		</input>
		<output>
			<property>autopilot/LGUIDE/Beta_Integ</property>
		</output>
	</filter>
	<!-- sum of beam error , beam error washout and beam error integrator -->
	<filter>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<expression>
				<sum>
					<property>autopilot/LGUIDE/Beta_Lag_limited</property>
					<product>
						<property>autopilot/LGUIDE/Beta_Integ</property>
						<property>autopilot/LGUIDE/a3</property>
					</product>
					<property>autopilot/LGUIDE/Beta_dot</property>
				</sum>
			</expression>
		</input>
		<output>
			<property>autopilot/LGUIDE/Beta_E_sum</property>
		</output>
	</filter>

	<!--  ################################################################ -->
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<!-- page 220 -->
	<filter>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<property>autopilot/LGUIDE/PSI</property>
		</input>
		<reference>
			<property>autopilot/LGUIDE/THETRR</property>
		</reference>
		<output>
			<property>autopilot/LGUIDE/CPER</property>
		</output>
		<period><min>-180</min><max>180</max></period>
	</filter>
	<filter>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<property>autopilot/LGUIDE/CPER</property>
		</input>
		<output>
			<property>autopilot/LGUIDE/CPERLIM</property>
		</output>
		<u_min>-25</u_min><u_max>25</u_max>
		<!-- limit  LGL3 -->
	</filter>
	<filter>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<expression>
				<abs>
					<property>autopilot/LGUIDE/Beta_Lag</property>
				</abs>
			</expression>
		</input>
		<output>
			<property>autopilot/LGUIDE/Beta_Lag_abs</property>
		</output>
	</filter>
	<filter>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<expression>
				<abs>
					<property>autopilot/LGUIDE/Beta_Deg</property>
				</abs>
			</expression>
		</input>
		<output>
			<property>autopilot/LGUIDE/Beta_Deg_abs</property>
		</output>
	</filter>
	<!-- LOC signal at max limit -->
	<!-- beam error -->
	<logic>
		<debug>false</debug>
		<input>
			<greater-than>
				<property>autopilot/LGUIDE/Beta_Deg_abs</property>
				<value>9.9</value>
			</greater-than>
		</input>
		<output>
			<property>autopilot/LGUIDE/LOClimited</property>
		</output>
	</logic>
	
	<filter>
		<debug>false</debug>
		<type>gain</type>
		<gain>1.0</gain>
		<input>
			<expression>
				<difference>
					<sum>
						<product>
							<property>autopilot/LGUIDE/KCL1</property>
							<sum>
								<difference>
									<value>1.0</value>
									<cos>
										<property>autopilot/LGUIDE/CPER</property>
									</cos>
								</difference>
							</sum>
						</product>
						<product>
							<property>autopilot/LGUIDE/KCL2</property>
							<property>autopilot/LGUIDE/Beta_Deg_abs</property>
						</product>
					</sum>
					<sum>
						<product>
							<!-- should be scaled by DME/72690 (ft) -->
							<property>autopilot/LGUIDE/KCL3</property>
							<property>autopilot/LGUIDE/Beta_Lag_abs</property>
						</product>
					</sum>
				</difference>
			</expression>
		</input>
		<output>
			<property>autopilot/LGUIDE/CBTEST</property>
		</output>
	</filter>
	<!-- page 221 -->
</PropertyList>
